---
import Layout from "../../layouts/WMBase.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props as { post: import("astro:content").CollectionEntry<"blog"> };
const { Content } = await post.render();
const canonical = `https://windowmaintenance.co.nz/blog/${post.slug}/`;
const title = post.data.title;
const description = post.data.description ?? "";
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: title,
  description,
  datePublished: post.data.pubDate,
  dateModified: post.data.pubDate,
  mainEntityOfPage: canonical,
  author: { "@type": "Organization", name: "Window Maintenance" },
  publisher: { "@type": "Organization", name: "Window Maintenance", logo: { "@type": "ImageObject", url: "/favicon-32x32.png" } },
  image: "/img/og-cover.jpg"
};
---
<Layout title={title} description={description} canonical={canonical} schema={[articleSchema]}>
  <main class="mx-auto max-w-3xl px-6 py-12">
    <nav class="text-sm text-slate-400"><a href="/blog/" class="hover:text-amber-400">&larr; Back to blog</a></nav>
    <article class="prose prose-invert prose-slate max-w-none">
      <header class="mb-6">
        <h1 class="mb-2 text-3xl font-extrabold">{post.data.title}</h1>
        <div class="text-xs text-slate-400">{new Date(post.data.pubDate).toLocaleDateString()}</div>
      </header>
      <Content />
    </article>
  </main>
</Layout>
